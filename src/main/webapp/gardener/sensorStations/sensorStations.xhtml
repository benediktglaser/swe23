<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3c.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/main.xhtml">

    <ui:define name="content">
        <form id="downloadForm" method="get">
            <!--<a onclick="downloadImage(); return false;">Klicken Sie hier</a>-->
        </form>

        <h:form id="sensorStationForm">
            <div class="card">
                <p:outputPanel>
                    <p:carousel id="sensorstation" value="#{sensorStationListController.getAllSensorStationByOwner()}" var="sensorStation"
                                numVisible="3" numScroll="3">
                        <div class="sensorStation-item">
                            <div class="sensorStation-item-content">
                                <!--<a href="http://localhost:8080/visitor/sensorStations/gallery.xhtmlc57004cc-ca72-41a0-9432-754e642696cb" download="true">Download QRCode</a>-->
                                <div class="mb-3">
                                    <h:graphicImage library="images" name="#{sensorStationListController.getFrontPicture(sensorStation)}" height="100" width="200"/>
                                </div>
                                <div>

                                    <h4 class="mb-1">#{sensorStation.name}</h4>
                                    <h6 class="mt-0 mb-3">
                                    </h6>
                                    <p:commandButton id="edit"
                                                     update=":sensorStationForm"
                                                     oncomplete="PF('sensorStationFormEditDialog').show()"
                                                     icon="pi pi-pencil"
                                                     action="#{sensorDataTypeListController.setSensorStation(sensorStation)}"/>
                                    <p:commandButton id="sensordata" value="Sensordata"
                                                     action="#{sensorStationListController.redirectToSensorDataPage(sensorStation)}"/>
                                    <p:commandButton id="gallery" value="Gallery"
                                                     action="#{sensorStationListController.redirectToGallery(sensorStation)}"/>
                                    <p:commandButton id="download" value="DownloadQRCode" action="#{QRCodeController.doUpdate(sensorStation.id)}"/>
                                    <script>
                                        function sent(param){
                                            const sensorLink = "http://localhost:8080/visitor/sensorStations/gallery.xhtml";
                                            const sensorUrl = sensorLink+param;
                                            document.getElementById("downloadForm").setAttribute("action", sensorUrl);
                                            document.getElementById("downloadForm").submit();
                                        }
                                    </script>
                                </div>
                            </div>
                        </div>
                    </p:carousel>
                </p:outputPanel>
            </div>
            <p:dialog header="Sensor Station Info" id="sensorStationFormEditDialog"
                      widgetVar="sensorStationFormEditDialog" modal="true" showEffect="fade" hideEffect="fade"
                      resizable="false" onHide="sensorDataTypeInfoController.resetSensorDataTypeInfoController()">
                <p:outputPanel id="sensorStationTypeData">
                    <p:dataTable id="dataTable"
                                 value="#{sensorDataTypeListController.getAllSensorDataTypeBySensorStation()}"
                                 var="type" scrollable="true" scrollHeight="400">

                        <p:column headerText="Sensor Type">
                            <h:outputText value="#{type.type}"/>
                        </p:column>
                        <p:column headerText="Min Limit">
                            <h:outputText value="#{type.getMinLimit()}"/>
                        </p:column>
                        <p:column headerText="Max Limit">
                            <h:outputText value="#{type.maxLimit}"/>
                        </p:column>
                        <p:column headerText="Create Date">
                            <h:outputText value="#{type.createDate.toLocalDate()}"/>
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>




                <p:outputPanel id="sensorInfo">
                    <p:selectOneMenu id="types" value="#{sensorDataTypeInfoController.sensorDataType}">
                        <f:selectItems value="#{sensorDataTypeInfoController.allTypes}" var="sensorType"
                                       itemLabel="#{sensorType.name()}" itemValue="#{sensorType}"/>
                    </p:selectOneMenu>
                    <p:messages id="msgs"/>
                    <h:panelGrid columns="2" styleClass="mb-3">
                        <p:outputLabel for="min" value="Min Limit: "/>
                        <p:inputText id="min" value="#{sensorDataTypeInfoController.type.minLimit}" >
                        </p:inputText>
                        <p:outputLabel for="max" value="Max Limit: "/>
                        <p:inputText id="max" value="#{sensorDataTypeInfoController.type.maxLimit}">
                        </p:inputText>

                    </h:panelGrid>
                    <p:separator/>
                    <h:panelGrid columns="1">
                        <p:commandButton value="Save"
                                         id="saveButton"
                                         action="#{sensorDataTypeInfoController.save(sensorDataTypeListController.getSensorStation())}"
                                         update=":sensorStationForm sensorStationForm:sensorStationFormEditDialog"
                                         process="@parent:@parent" oncomplete="handleSave()" styleClass="mr-2">
                        </p:commandButton>
                    </h:panelGrid>


                </p:outputPanel>
                <script>
                    function handleSave() {
                        PF('sensorStationFormEditDialog').show();
                    }
                </script>
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>